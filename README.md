# PayWave - Confidential On-chain Payroll

<p align="center">
  <strong>ğŸ” Privacy-preserving payroll powered by Fully Homomorphic Encryption (FHE)</strong>
</p>

<p align="center">
  <a href="#æ ¸å¿ƒæ¦‚å¿µ">æ ¸å¿ƒæ¦‚å¿µ</a> â€¢
  <a href="#ç³»çµ±æ¶æ§‹">ç³»çµ±æ¶æ§‹</a> â€¢
  <a href="#åˆç´„è¨­è¨ˆ">åˆç´„è¨­è¨ˆ</a> â€¢
  <a href="#è³‡æ–™æµç¨‹">è³‡æ–™æµç¨‹</a> â€¢
  <a href="#å®‰å…¨æ¨¡å‹">å®‰å…¨æ¨¡å‹</a>
</p>

---

## å°ˆæ¡ˆç°¡ä»‹

PayWave æ˜¯ä¸€å€‹**æ©Ÿå¯†éˆä¸Šè–ªè³‡ç³»çµ± MVP**ï¼Œåˆ©ç”¨ [Zama FHEVM](https://www.zama.ai/fhevm) çš„å…¨åŒæ…‹åŠ å¯†ï¼ˆFHEï¼‰æŠ€è¡“ï¼Œå¯¦ç¾ï¼š

- ğŸ’° **å…¬é–‹å­˜æ¬¾ï¼Œç§å¯†åˆ†ç™¼** â€” USDC å­˜å…¥é‡‘åº«æ˜¯å¯è¦‹çš„ï¼Œä½†å€‹äººè–ªè³‡åˆ†é…å®Œå…¨åŠ å¯†
- ğŸ” **ç«¯åˆ°ç«¯åŠ å¯†è–ªè³‡å–®** â€” åŸºæœ¬è–ªè³‡ã€çé‡‘ã€æ‰£æ¬¾å…¨éƒ¨ä»¥å¯†æ–‡å­˜å„²
- âœ… **å“¡å·¥è‡ªä¸»é©—è­‰** â€” å“¡å·¥å¯è§£å¯†ä¸¦åœ¨æœ¬åœ°é©—è­‰è¨ˆç®—æ­£ç¢ºæ€§
- ğŸ›ï¸ **åˆè¦å­˜å–æ©Ÿåˆ¶** â€” æ”¿åºœå­˜å–éœ€é›™æ–¹æ‰¹å‡† + 24 å°æ™‚æ™‚é–“é–

---

## æ ¸å¿ƒæ¦‚å¿µ

### ç‚ºä»€éº¼éœ€è¦æ©Ÿå¯†è–ªè³‡ï¼Ÿ

å‚³çµ±å€å¡Šéˆçš„é€æ˜æ€§ä½¿å¾—è–ªè³‡æ”¯ä»˜æˆç‚ºéš±ç§å™©å¤¢ï¼š

| å•é¡Œ | å‚³çµ±éˆä¸Šæ”¯ä»˜ | PayWave |
|------|-------------|---------|
| è–ªè³‡é‡‘é¡ | âŒ å®Œå…¨å…¬é–‹ | âœ… åªæœ‰å“¡å·¥å¯è¦‹ |
| åŒäº‹æ¯”è¼ƒ | âŒ ä»»ä½•äººå¯æŸ¥ | âœ… ç„¡æ³•æ¯”è¼ƒ |
| å•†æ¥­æ©Ÿå¯† | âŒ ç«¶çˆ­å°æ‰‹å¯åˆ†æ | âœ… æ”¯å‡ºæ¨¡å¼éš±è— |
| åˆè¦éœ€æ±‚ | âŒ ç„¡æ³•æ»¿è¶³ GDPR | âœ… æœ€å°åŒ–æ­éœ²åŸå‰‡ |

### FHE å¦‚ä½•è§£æ±ºï¼Ÿ

**å…¨åŒæ…‹åŠ å¯† (Fully Homomorphic Encryption)** å…è¨±åœ¨å¯†æ–‡ä¸Šç›´æ¥é€²è¡Œè¨ˆç®—ï¼Œç„¡éœ€è§£å¯†ï¼š

```
åŠ å¯†(åŸºæœ¬è–ªè³‡) + åŠ å¯†(çé‡‘) - åŠ å¯†(æ‰£æ¬¾) = åŠ å¯†(æ·¨è–ªè³‡)
     â†“                â†“              â†“              â†“
   å¯†æ–‡A    +      å¯†æ–‡B     -     å¯†æ–‡C     =    å¯†æ–‡D
```

è¨ˆç®—éç¨‹ä¸­ï¼Œ**æ²’æœ‰ä»»ä½•äºº**ï¼ˆåŒ…æ‹¬å€å¡Šéˆç¯€é»ï¼‰èƒ½çœ‹åˆ°å¯¦éš›é‡‘é¡ã€‚

---

## ç³»çµ±æ¶æ§‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           PayWave ç³»çµ±æ¶æ§‹                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                     â”‚
â”‚    â”‚    USDC      â”‚  å…¬é–‹ ERC20 ä»£å¹£                                     â”‚
â”‚    â”‚  (Public)    â”‚                                                     â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                                     â”‚
â”‚           â”‚ deposit()                                                   â”‚
â”‚           â–¼                                                             â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                     â”‚
â”‚    â”‚ USDCWrapper  â”‚  åŒ…è£å™¨ï¼šUSDC â†” cUSDC è½‰æ›                           â”‚
â”‚    â”‚              â”‚  â€¢ deposit(): USDC â†’ cUSDC (é‡‘é¡å…¬é–‹)                â”‚
â”‚    â”‚              â”‚  â€¢ withdraw(): cUSDC â†’ USDC (é‡‘é¡å…¬é–‹)               â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                                     â”‚
â”‚           â”‚ mint()                                                      â”‚
â”‚           â–¼                                                             â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                     â”‚
â”‚    â”‚    cUSDC     â”‚  æ©Ÿå¯† USDC ä»£å¹£                                      â”‚
â”‚    â”‚ (Encrypted)  â”‚  â€¢ é¤˜é¡ä»¥ euint64 åŠ å¯†å­˜å„²                            â”‚
â”‚    â”‚              â”‚  â€¢ transferEncryptedFrom(): é‡‘é¡åŠ å¯†è½‰å¸³             â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                                     â”‚
â”‚           â”‚                                                             â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚    â”‚                                               â”‚                    â”‚
â”‚    â–¼                                               â–¼                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚   Treasury   â”‚                          â”‚   Payroll    â”‚            â”‚
â”‚  â”‚  (é‡‘åº«)      â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  (è–ªè³‡åˆç´„)   â”‚            â”‚
â”‚  â”‚              â”‚   pay() è§¸ç™¼åŠ å¯†è½‰å¸³       â”‚              â”‚            â”‚
â”‚  â”‚ æŒæœ‰å…¬å¸çš„    â”‚                          â”‚ â€¢ å­˜å„²åŠ å¯†è–ªå–® â”‚            â”‚
â”‚  â”‚ cUSDC é¤˜é¡   â”‚                          â”‚ â€¢ FHE è¨ˆç®—æ·¨é¡ â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚ â€¢ ACL æ¬Šé™æ§åˆ¶ â”‚            â”‚
â”‚                                            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                   â”‚                    â”‚
â”‚                                                   â”‚ grantGovAccess()   â”‚
â”‚                                                   â–¼                    â”‚
â”‚                                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚                                            â”‚ Compliance   â”‚            â”‚
â”‚                                            â”‚    Gate      â”‚            â”‚
â”‚                                            â”‚ (åˆè¦é–˜é“)    â”‚            â”‚
â”‚                                            â”‚              â”‚            â”‚
â”‚                                            â”‚ â€¢ é›™é‡æ‰¹å‡†    â”‚            â”‚
â”‚                                            â”‚ â€¢ 24h æ™‚é–“é–  â”‚            â”‚
â”‚                                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## åˆç´„è¨­è¨ˆ

### 1. cUSDC - æ©Ÿå¯† USDC ä»£å¹£

**æª”æ¡ˆ**: `contracts/src/cUSDC.sol`

cUSDC æ˜¯ USDC çš„åŠ å¯†åŒ…è£ç‰ˆæœ¬ï¼Œæ‰€æœ‰é¤˜é¡éƒ½ä»¥ `euint64`ï¼ˆåŠ å¯†çš„ 64 ä½å…ƒç„¡è™Ÿæ•´æ•¸ï¼‰å­˜å„²ã€‚

```solidity
// é¤˜é¡å­˜å„²ï¼šåœ°å€ â†’ åŠ å¯†é¤˜é¡
mapping(address => euint64) private _encryptedBalances;
```

**é—œéµè¨­è¨ˆæ±ºç­–**ï¼š

| æ“ä½œ | é‡‘é¡å¯è¦‹æ€§ | åŸå›  |
|------|-----------|------|
| `mint()` | å…¬é–‹ | å­˜æ¬¾é‡‘é¡æœ¬ä¾†å°±æ˜¯å…¬é–‹äº¤æ˜“ |
| `burn()` | å…¬é–‹ | ææ¬¾é‡‘é¡æœ¬ä¾†å°±æ˜¯å…¬é–‹äº¤æ˜“ |
| `transferEncryptedFrom()` | **åŠ å¯†** | è–ªè³‡è½‰å¸³å¿…é ˆä¿å¯† |

**ç‚ºä»€éº¼ä¸ç”¨æ¨™æº– ERC20ï¼Ÿ**

æ¨™æº– ERC20 çš„ `transfer(to, amount)` ä¸­ `amount` æ˜¯å…¬é–‹çš„ã€‚æˆ‘å€‘éœ€è¦çš„æ˜¯ï¼š
```solidity
function transferEncryptedFrom(
    address from,
    address to,
    euint64 amountHandle  // åŠ å¯†çš„é‡‘é¡ handle
) external onlyPayroll;
```

åªæœ‰ Payroll åˆç´„èƒ½èª¿ç”¨æ­¤å‡½æ•¸ï¼Œä¸”é‡‘é¡æ˜¯åŠ å¯†çš„ handleï¼Œç„¡äººèƒ½ç›´æ¥è®€å–ã€‚

---

### 2. Payroll - æ ¸å¿ƒè–ªè³‡åˆç´„

**æª”æ¡ˆ**: `contracts/src/Payroll.sol`

Payroll æ˜¯ç³»çµ±çš„æ ¸å¿ƒï¼Œè² è²¬ï¼š
1. å­˜å„²åŠ å¯†è–ªè³‡å–®
2. åŸ·è¡Œ FHE è¨ˆç®—
3. ç®¡ç† ACL è§£å¯†æ¬Šé™

#### è–ªè³‡å–®çµæ§‹

```solidity
struct Payslip {
    // === åŠ å¯†æ¬„ä½ (åªæœ‰æˆæ¬Šæ–¹èƒ½è§£å¯†) ===
    euint64 base;               // åŸºæœ¬è–ªè³‡
    euint64 bonus;              // çé‡‘
    euint64 penalty;            // æ‰£æ¬¾
    euint64 unpaidLeaveDeduct;  // ç„¡è–ªå‡æ‰£é™¤
    euint64 net;                // è¨ˆç®—å¾Œçš„æ·¨é¡
    
    // === å…¬é–‹å…ƒè³‡æ–™ ===
    PayslipStatus status;       // DRAFT â†’ COMPUTED â†’ PAID
    bytes32 policyHash;         // æ”¿ç­–ç‰ˆæœ¬é›œæ¹Š (å¯©è¨ˆç”¨)
    uint256 createdAt;
    uint256 computedAt;
    uint256 paidAt;
}
```

**ç‚ºä»€éº¼åˆ†é–‹å­˜å„²ï¼Ÿ**

- **åŠ å¯†æ¬„ä½**ï¼šå¯¦éš›é‡‘é¡ï¼Œéœ€è¦ FHE ä¿è­·
- **å…¬é–‹å…ƒè³‡æ–™**ï¼šç‹€æ…‹ã€æ™‚é–“æˆ³ç­‰ï¼Œç”¨æ–¼æµç¨‹è¿½è¹¤å’Œå¯©è¨ˆ

#### FHE æ·¨é¡è¨ˆç®—

```solidity
function computePayslip(address employee, uint32 period) external onlyIssuer {
    Payslip storage slip = payslips[employee][period];
    
    // åŒæ…‹åŠ æ³•ï¼šgross = base + bonus
    euint64 gross = FHEVM.add(slip.base, slip.bonus);
    
    // åŒæ…‹åŠ æ³•ï¼šdeduct = penalty + unpaidLeaveDeduct  
    euint64 deduct = FHEVM.add(slip.penalty, slip.unpaidLeaveDeduct);
    
    // åŒæ…‹æ¯”è¼ƒ + æ¢ä»¶é¸æ“‡ï¼šnet = max(gross - deduct, 0)
    ebool isPositive = FHEVM.gte(gross, deduct);
    euint64 difference = FHEVM.sub(gross, deduct);
    slip.net = FHEVM.select(isPositive, difference, FHEVM.zero());
    
    // æˆäºˆå“¡å·¥è§£å¯†æ¬Šé™
    ACL.allow(slip.base, employee);
    ACL.allow(slip.bonus, employee);
    ACL.allow(slip.penalty, employee);
    ACL.allow(slip.unpaidLeaveDeduct, employee);
    ACL.allow(slip.net, employee);
}
```

**è¨ˆç®—å…¬å¼**ï¼š
```
æ·¨è–ªè³‡ = max(åŸºæœ¬è–ªè³‡ + çé‡‘ - æ‰£æ¬¾ - ç„¡è–ªå‡æ‰£é™¤, 0)
```

æ•´å€‹è¨ˆç®—åœ¨å¯†æ–‡ä¸Šé€²è¡Œï¼Œå€å¡Šéˆç¯€é»åªçœ‹åˆ° handle çš„æ“ä½œï¼Œç„¡æ³•å¾—çŸ¥å¯¦éš›æ•¸å€¼ã€‚

#### ACL æ¬Šé™æ§åˆ¶

ACLï¼ˆAccess Control Listï¼‰æ±ºå®šèª°èƒ½è§£å¯†å“ªå€‹å¯†æ–‡ï¼š

```solidity
// å“¡å·¥åªèƒ½è§£å¯†è‡ªå·±çš„è–ªè³‡å–®
ACL.allow(slip.net, employee);

// Payroll åˆç´„æœ¬èº«éœ€è¦æ¬Šé™ä¾†åŸ·è¡Œæ”¯ä»˜
ACL.allow(slip.net, address(this));

// æ”¯ä»˜æ™‚ï¼Œçµ¦äºˆ cUSDC åˆç´„è‡¨æ™‚æ¬Šé™
ACL.allowTransient(slip.net, address(token));
```

| æ¬Šé™é¡å‹ | ç”¨é€” | ç”Ÿå‘½é€±æœŸ |
|---------|------|---------|
| `allow()` | æ°¸ä¹…æˆæ¬Š | ç›´åˆ°æ˜ç¢ºæ’¤éŠ· |
| `allowTransient()` | äº¤æ˜“å…§è‡¨æ™‚æˆæ¬Š | äº¤æ˜“çµæŸè‡ªå‹•æ’¤éŠ· |

---

### 3. USDCWrapper - å…¬ç§è½‰æ›å™¨

**æª”æ¡ˆ**: `contracts/src/USDCWrapper.sol`

Wrapper æ˜¯å…¬é–‹ä¸–ç•Œï¼ˆUSDCï¼‰èˆ‡æ©Ÿå¯†ä¸–ç•Œï¼ˆcUSDCï¼‰çš„æ©‹æ¨‘ã€‚

```
        å­˜æ¬¾æµç¨‹                          ææ¬¾æµç¨‹
    
    USDC (å…¬é–‹)                       cUSDC (åŠ å¯†)
        â”‚                                 â”‚
        â”‚ transferFrom()                  â”‚ burn()
        â–¼                                 â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Wrapper â”‚                      â”‚ Wrapper â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
         â”‚ mint()                         â”‚ transfer()
         â–¼                                â–¼
    cUSDC (åŠ å¯†)                      USDC (å…¬é–‹)
```

**è¨­è¨ˆåŸå‰‡**ï¼š
- å­˜æ¬¾/ææ¬¾é‡‘é¡æ˜¯å…¬é–‹çš„ï¼ˆç„¡æ³•éš±è—ï¼Œå› ç‚º USDC æ˜¯å…¬é–‹ä»£å¹£ï¼‰
- ä½†å­˜å…¥å¾Œçš„**åˆ†é…**æ˜¯æ©Ÿå¯†çš„

---

### 4. PayrollTreasury - å…¬å¸é‡‘åº«

**æª”æ¡ˆ**: `contracts/src/PayrollTreasury.sol`

é‡‘åº«æ˜¯ç°¡å–®çš„ cUSDC æŒæœ‰åˆç´„ï¼Œä»£è¡¨å…¬å¸çš„è–ªè³‡è³‡é‡‘æ± ã€‚

```solidity
contract PayrollTreasury {
    cUSDC public token;
    address public payroll;  // åªæœ‰ Payroll èƒ½å¾é‡‘åº«è½‰å‡º
}
```

**ç‚ºä»€éº¼éœ€è¦ç¨ç«‹é‡‘åº«ï¼Ÿ**
1. **æ¬Šé™éš”é›¢**ï¼šè–ªè³‡è³‡é‡‘èˆ‡å…¬å¸å…¶ä»–è³‡é‡‘åˆ†é›¢
2. **å¯©è¨ˆè¿½è¹¤**ï¼šæ¸…æ™°çš„è³‡é‡‘æµå‘
3. **å¤šç°½æ§åˆ¶**ï¼šå¯å‡ç´šç‚ºå¤šç°½é‡‘åº«

---

### 5. ComplianceGate - åˆè¦é–˜é“

**æª”æ¡ˆ**: `contracts/src/ComplianceGate.sol`

é€™æ˜¯ Break-Glassï¼ˆæ‰“ç ´ç»ç’ƒï¼‰æ©Ÿåˆ¶ï¼Œç”¨æ–¼åˆæ³•åˆè¦å ´æ™¯ï¼ˆå¦‚æ³•é™¢å‘½ä»¤ã€ç¨…å‹™å¯©è¨ˆï¼‰ã€‚

#### æ¡ˆä»¶ç‹€æ…‹æ©Ÿ

```
  requestCase()        approveByIssuer()      approveByGov()         execute()
       â”‚                    â”‚                      â”‚                     â”‚
       â–¼                    â–¼                      â–¼                     â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ PENDING â”‚â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ ISSUER   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚  FULLY   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ EXECUTED â”‚
   â”‚         â”‚        â”‚ APPROVED â”‚          â”‚ APPROVED â”‚  24hå¾Œ   â”‚          â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                  â”‚
                                                  â”‚ 24å°æ™‚æ™‚é–“é–
                                                  â–¼
                                            å“¡å·¥æ”¶åˆ°é€šçŸ¥
                                            å¯æå‡ºç•°è­°
```

#### é›™é‡æ‰¹å‡† + æ™‚é–“é–

```solidity
struct Case {
    address employee;        // ç›®æ¨™å“¡å·¥
    uint32 period;           // ç›®æ¨™æœŸé–“
    bytes32 reasonHash;      // åŸå› é›œæ¹Šï¼ˆéš±ç§ä¿è­·ï¼‰
    string evidenceURI;      // è­‰æ“šæ–‡ä»¶ URI
    bool issuerApproved;     // âœ“ ç™¼è¡Œæ–¹ï¼ˆå…¬å¸ï¼‰æ‰¹å‡†
    bool govApproved;        // âœ“ æ”¿åºœæ‰¹å‡†
    uint256 unlockTime;      // 24å°æ™‚å¾Œçš„æ™‚é–“æˆ³
    bool executed;           // æ˜¯å¦å·²åŸ·è¡Œ
}

uint256 public constant TIMELOCK_DURATION = 24 hours;
```

**ç‚ºä»€éº¼éœ€è¦é€™å€‹è¨­è¨ˆï¼Ÿ**

| ä¿è­·æªæ–½ | é˜²æ­¢çš„æ”»æ“Š |
|---------|-----------|
| é›™é‡æ‰¹å‡† | å–®æ–¹é¢æ¿«ç”¨ï¼ˆå…¬å¸æˆ–æ”¿åºœä»»ä¸€æ–¹ä¸èƒ½ç¨è‡ªå­˜å–ï¼‰ |
| 24h æ™‚é–“é– | ç·Šæ€¥å‰è»Šï¼Œè®“å“¡å·¥æœ‰æ™‚é–“æ”¶åˆ°é€šçŸ¥ä¸¦æå‡ºç•°è­° |
| äº‹ä»¶æ—¥èªŒ | æ‰€æœ‰å­˜å–è«‹æ±‚éƒ½ä¸Šéˆï¼Œç„¡æ³•æŠµè³´ |

---

## è³‡æ–™æµç¨‹

### å®Œæ•´è–ªè³‡æ”¯ä»˜æµç¨‹

```
    ç™¼è¡Œæ–¹ (HR)                    å€å¡Šéˆ                      å“¡å·¥
        â”‚                            â”‚                          â”‚
   1. å­˜æ¬¾ USDC                      â”‚                          â”‚
        â”‚â”€â”€â”€â”€ deposit(10000) â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                          â”‚
        â”‚     [å…¬é–‹: 10000 USDC]     â”‚                          â”‚
        â”‚                            â”‚                          â”‚
   2. è¨­å®šåŠ å¯†è–ªè³‡å–®                  â”‚                          â”‚
        â”‚â”€â”€ setPayslipInputs() â”€â”€â”€â”€â”€â–¶â”‚                          â”‚
        â”‚   [å¯†æ–‡: base, bonus...]   â”‚                          â”‚
        â”‚                            â”‚                          â”‚
   3. è¨ˆç®—æ·¨è–ªè³‡                      â”‚                          â”‚
        â”‚â”€â”€ computePayslip() â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                          â”‚
        â”‚   [FHE: net = base+bonus-deduct]                      â”‚
        â”‚                            â”‚â”€â”€ ACL.allow(net, alice)â”€â–¶â”‚
        â”‚                            â”‚                          â”‚
   4. åŸ·è¡Œæ”¯ä»˜                        â”‚                          â”‚
        â”‚â”€â”€â”€â”€â”€â”€â”€â”€ pay() â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                          â”‚
        â”‚   [åŠ å¯†è½‰å¸³: Treasuryâ†’Alice]â”‚                          â”‚
        â”‚                            â”‚                          â”‚
        â”‚                            â”‚                     5. è§£å¯†æŸ¥çœ‹
        â”‚                            â”‚â—€â”€â”€ decrypt(net) â”€â”€â”€â”€â”€â”€â”€â”€â”‚
        â”‚                            â”‚â”€â”€â”€â”€ 5050 cUSDC â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
        â”‚                            â”‚                          â”‚
        â”‚                            â”‚                     6. æœ¬åœ°é©—è­‰
        â”‚                            â”‚          [5000+500-450 = 5050 âœ“]
```

### äº‹ä»¶è¿½è¹¤ï¼ˆå¯©è¨ˆå‹å¥½ï¼‰

æ‰€æœ‰é—œéµæ“ä½œéƒ½ç™¼å‡ºäº‹ä»¶ï¼Œä½†**ä¸åŒ…å«é‡‘é¡**ï¼š

```solidity
// âœ… è¨˜éŒ„èª°ã€ä½•æ™‚ã€å“ªå€‹æœŸé–“ â€” ä¸è¨˜éŒ„å¤šå°‘éŒ¢
event PayslipPaid(
    address indexed employee,
    uint32 indexed period,
    uint256 payslipId,
    bytes32 paymentRef
);

// âŒ æˆ‘å€‘çµ•ä¸é€™æ¨£åš
event PayslipPaid(
    address employee,
    uint256 amount  // æ´©æ¼è–ªè³‡ï¼
);
```

---

## å®‰å…¨æ¨¡å‹

### å¨è„…æ¨¡å‹èˆ‡å°ç­–

| å¨è„… | æ”»æ“Šè€… | å°ç­– |
|------|-------|------|
| è–ªè³‡æ´©æ¼ | å¤–éƒ¨è§€å¯Ÿè€… | FHE åŠ å¯†ï¼Œå¯†æ–‡ç„¡æ³•è§£è®€ |
| å…§éƒ¨æ´©æ¼ | æƒ¡æ„ HR | ACL é™åˆ¶ï¼ŒHR ä¸èƒ½è§£å¯†å“¡å·¥è–ªè³‡ |
| æ”¿åºœæ¿«ç”¨ | å–®ä¸€å®˜å“¡ | é›™é‡æ‰¹å‡† + æ™‚é–“é– |
| åˆç´„æ¼æ´ | é§­å®¢ | è§’è‰²åˆ†é›¢ã€æœ€å°æ¬Šé™åŸå‰‡ |
| é‡æ”¾æ”»æ“Š | æ”»æ“Šè€… | period åƒæ•¸é˜²æ­¢é‡è¤‡æ”¯ä»˜ |

### æ¬Šé™çŸ©é™£

| è§’è‰² | setPayslipInputs | computePayslip | pay | grantGovAccess | decrypt |
|------|-----------------|----------------|-----|----------------|---------|
| Owner | âŒ | âŒ | âŒ | âŒ | âŒ |
| Issuer | âœ… | âœ… | âœ… | âŒ | âŒ |
| Employee | âŒ | âŒ | âŒ | âŒ | âœ… (è‡ªå·±çš„) |
| Government | âŒ | âŒ | âŒ | âŒ | âœ… (ç¶“æ‰¹å‡†çš„) |
| ComplianceGate | âŒ | âŒ | âŒ | âœ… | âŒ |

### ä¸å¯èƒ½ç™¼ç”Ÿçš„æƒ…æ³

1. **HR ç„¡æ³•çœ‹åˆ°å“¡å·¥è–ªè³‡** â€” ACL ä¸æˆæ¬Šçµ¦ Issuer
2. **å“¡å·¥ç„¡æ³•çœ‹åˆ°åŒäº‹è–ªè³‡** â€” ACL åªæˆæ¬Šçµ¦æœ¬äºº
3. **æ”¿åºœç„¡æ³•ç«‹å³å­˜å–** â€” å¿…é ˆç­‰å¾… 24 å°æ™‚
4. **å–®æ–¹é¢ç„¡æ³•æˆæ¬Šæ”¿åºœ** â€” éœ€è¦å…¬å¸ + æ”¿åºœé›™æ–¹æ‰¹å‡†

---

## æŠ€è¡“è¦æ ¼

### åˆç´„æ¸…å–®

| åˆç´„ | åŠŸèƒ½ | LOC |
|------|------|-----|
| `FHEVM.sol` | FHE æ“ä½œæ¨¡æ“¬åº« | ~150 |
| `cUSDC.sol` | æ©Ÿå¯† USDC ä»£å¹£ | ~190 |
| `USDCWrapper.sol` | USDC â†” cUSDC æ©‹æ¥ | ~100 |
| `PayrollTreasury.sol` | å…¬å¸é‡‘åº« | ~80 |
| `Payroll.sol` | æ ¸å¿ƒè–ªè³‡é‚è¼¯ | ~440 |
| `ComplianceGate.sol` | åˆè¦å­˜å–é–˜é“ | ~300 |

### ä¾è³´é …

- Solidity `^0.8.24`
- OpenZeppelin Contracts (SafeERC20)
- Hardhat é–‹ç™¼æ¡†æ¶

### éˆæ”¯æ´

- æœ¬åœ°é–‹ç™¼ï¼šHardhat Network
- æ¸¬è©¦ç¶²ï¼šSepolia, Zama FHEVM Devnet
- ä¸»ç¶²ï¼šéœ€å¯¦éš› FHEVM æ”¯æ´

---

## é™åˆ¶èˆ‡æœªä¾†å·¥ä½œ

### ç•¶å‰ MVP é™åˆ¶

1. **Mock FHE** â€” ä½¿ç”¨æ¨¡æ“¬ FHE åº«ï¼ŒéçœŸå¯¦åŠ å¯†
2. **å–®ä¸€ç™¼è¡Œæ–¹** â€” å°šæœªæ”¯æ´å¤šå…¬å¸
3. **ç„¡æ‰¹æ¬¡æ”¯ä»˜** â€” éœ€é€ä¸€æ”¯ä»˜å“¡å·¥
4. **ç°¡åŒ–ç¨…å‹™** â€” æœªå¯¦ç¾å®Œæ•´ç¨…å‹™è¨ˆç®—

### æœªä¾†æ”¹é€²

- [ ] æ•´åˆçœŸå¯¦ Zama FHEVM
- [ ] å¤šå…¬å¸ / å¤šç§Ÿæˆ¶æ¶æ§‹
- [ ] æ‰¹æ¬¡è–ªè³‡è™•ç†
- [ ] ç¨…å‹™è‡ªå‹•ä»£æ‰£ä»£ç¹³
- [ ] è¡Œå‹•ç«¯ UI
- [ ] æ­£å¼å®‰å…¨å¯©è¨ˆ

---

## æˆæ¬Š

MIT License

---

<p align="center">
  <strong>Built with ğŸ” FHE for privacy-preserving payroll</strong>
</p>
